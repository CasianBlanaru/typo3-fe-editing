<!-- PixelCoda Frontend Editor Toolbar -->
<style>
    .pc-fe-toolbar {
        position: fixed;
        right: 1rem;
        bottom: 1rem;
        padding: .5rem;
        background: #111827;
        color: #F9FAFB;
        border-radius: .5rem;
        z-index: 99999;
        font: 14px/1.2 system-ui;
        box-shadow: 0 10px 25px rgba(0, 0, 0, .25);
        display: flex;
        gap: .5rem
    }

    .pc-fe-editable {
        outline: 2px dashed rgba(14, 165, 233, .5);
        outline-offset: 2px
    }

    .pc-fe-editable:focus {
        outline-color: #0ea5e9
    }

    .btn {
        width: 32px;
        height: 32px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        border-radius: 6px;
        background: transparent;
        border: none;
        cursor: pointer;
        transition: all .2s;
        color: white;
        font-size: 16px
    }

    .btn:hover {
        background: rgba(255, 255, 255, .1)
    }

    .btn.active {
        background: #0EA5E9;
        box-shadow: 0 0 0 2px rgba(14, 165, 233, .3)
    }
</style>

<div id="pc-fe-toolbar-root" class="pc-fe-toolbar">
    <button id="pc-edit-toggle" class="btn" title="Bearbeiten">✏️</button>
    <button id="pc-ai" class="btn" title="KI">🤖</button>
    <button id="pc-add-global" class="btn" title="Element hinzufügen">➕</button>
</div>

<script>
    (function() {
        let editMode = false;

        function setEditable(on) {
            document.querySelectorAll('h1, h2, h3, h4, h5, h6, p, div').forEach(el => {
                if (el.closest('.pc-fe-toolbar') || el.closest('nav') || el.closest('footer') || el.closest('.navbar')) return;
                if (on) {
                    el.contentEditable = 'true';
                    el.classList.add('pc-fe-editable');
                    el.dataset.pcField = 'true';
                } else {
                    el.contentEditable = 'false';
                    el.classList.remove('pc-fe-editable');
                    delete el.dataset.pcField;
                }
            });
        }

        document.addEventListener('click', function(e) {
            if (e.target.closest('#pc-edit-toggle')) {
                editMode = !editMode;
                setEditable(editMode);
                e.target.closest('#pc-edit-toggle').classList.toggle('active', editMode);
                alert(editMode ? '✏️ Edit-Modus aktiviert! Klicken Sie auf Texte zum Bearbeiten.' : '✏️ Edit-Modus deaktiviert!');
            }
            if (e.target.closest('#pc-ai')) {
                if (editMode) {
                    const editableElements = document.querySelectorAll('.pc-fe-editable');
                    if (editableElements.length > 0) {
                        editableElements[0].innerHTML = '🤖 [KI-Vorschlag] ' + editableElements[0].innerHTML;
                        alert('🤖 KI-Vorschlag hinzugefügt!');
                    } else {
                        alert('🤖 Keine editierbaren Elemente gefunden!');
                    }
                } else {
                    alert('🤖 Aktivieren Sie zuerst den Edit-Modus!');
                }
            }
            if (e.target.closest('#pc-add-global')) {
                alert('➕ Demo: Neues Inhaltselement würde hier erstellt werden!');
            }
        });

        document.addEventListener('focusout', function(e) {
            if (e.target.classList.contains('pc-fe-editable') && editMode) {
                const tagName = e.target.tagName.toLowerCase();
                alert('💾 Demo: Änderungen an "' + tagName + '" würden in TYPO3 gespeichert werden!');
            }
        });

        console.log('🚀 PixelCoda Frontend Editor Toolbar loaded successfully!');
    })();
</script>